<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offline Exam Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #f6f8fa;
      font-family: 'Montserrat', Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
      transition: background 0.3s;
    }
    body.dark-mode {
      background: #181a22;
      color: #eee;
    }
    .container {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      padding: 40px 30px;
      display: inline-block;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode .container {
      background: #23263a;
      color: #eee;
    }
    h1 {
      font-family: 'Montserrat', Arial, sans-serif;
      font-size: 2.6em;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
      letter-spacing: 2px;
      transition: color 0.3s;
    }
    body.dark-mode h1 {
      color: #f56565;
    }
    .big-timer {
      font-family: 'Roboto Mono', monospace;
      font-size: 7em;
      font-weight: 700;
      color: #e53e3e;
      text-shadow: 2px 4px 16px rgba(229,62,62,0.15);
      margin: 20px 0 0 0;
      padding: 6px 0;
      border-radius: 8px;
      background: #fff6f6;
      border: 2px solid #e53e3e22;
      box-sizing: border-box;
      transition: background 0.2s, color 0.2s;
      display: inline-block;
      min-width: 320px;
      position: relative;
      line-height: 1.1;
    }
    .big-timer-label {
      font-size: 1.2em;
      color: #3182ce;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      margin-bottom: 2px;
      display: block;
      letter-spacing: 1px;
    }
    body.dark-mode .big-timer-label {
      color: #f56565;
    }
    .breakdown {
      font-size: 1.1em;
      color: #3182ce;
      margin-top: 4px;
      font-family: 'Montserrat', Arial, sans-serif;
      letter-spacing: .5px;
      font-weight: 600;
      display: block;
    }
    body.dark-mode .breakdown {
      color: #f56565;
    }
    .option-group {
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #4a5568;
    }
    body.dark-mode .option-group {
      color: #eee;
    }
    label {
      font-size: 1.1em;
      margin: 0 12px;
      cursor: pointer;
    }
    input[type="number"], input[type="datetime-local"] {
      font-size: 1.2em;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #cbd5e0;
      outline: none;
      margin-left: 8px;
      background: #f8fafc;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    body.dark-mode input[type="number"], body.dark-mode input[type="datetime-local"] {
      background: #181a22;
      color: #eee;
      border: 1px solid #4a5568;
    }
    button {
      font-size: 1.15em;
      font-family: 'Montserrat', Arial, sans-serif;
      padding: 12px 36px;
      margin: 12px 8px 0 8px;
      border-radius: 8px;
      border: none;
      background: #3182ce;
      color: #fff;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(49,130,206,0.12);
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      outline: none;
    }
    button:hover {
      background: #2563eb;
      box-shadow: 0 4px 16px rgba(49,130,206,0.20);
    }
    button:active {
      background: #1e40af;
    }
    body.dark-mode button {
      background: #f56565;
      color: #222;
    }
    body.dark-mode button:hover {
      background: #c53030;
      color: #fff;
    }
    .preset-btn {
      font-size: 0.9em;
      padding: 7px 18px;
      margin: 0 7px;
      background: #cbd5e0;
      color: #2d3748;
      font-weight: 600;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      box-shadow: none;
      transition: background 0.2s, color 0.2s;
    }
    .preset-btn:hover {
      background: #a0aec0;
      color: #fff;
    }
    body.dark-mode .preset-btn {
      background: #2d3748;
      color: #eee;
    }
    body.dark-mode .preset-btn:hover {
      background: #f56565;
      color: #222;
    }
    .progress-bar {
      width: 100%;
      height: 27px;
      background: #e2e8f0;
      border-radius: 13px;
      margin: 18px 0 6px 0;
      overflow: hidden;
      position: relative;
      box-shadow: 0 2px 12px rgba(49,130,206,0.10);
    }
    .progress-inner {
      height: 100%;
      border-radius: 13px;
      width: 0%;
      transition: width 0.3s, background 0.3s;
      background: linear-gradient(90deg,#38d39f 10%,#3182ce 75%,#e53e3e 100%);
    }
    .progress-inner.urgent {
      background: linear-gradient(90deg,#e53e3e 75%,#f56565 100%);
    }
    .progress-inner.warning {
      background: linear-gradient(90deg,#ffdd57 20%,#e53e3e 100%);
    }
    body.dark-mode .progress-bar {
      background: #2d3748;
    }
    .controls {
      margin-top: 14px;
    }
    .sound-toggle, .dark-toggle {
      cursor: pointer;
      font-size: 1.3em;
      margin: 0 8px;
      vertical-align: middle;
      transition: color 0.2s;
    }
    .sound-toggle.muted {
      color: #a0aec0;
    }
    .sound-toggle.unmuted {
      color: #e53e3e;
    }
    .dark-toggle {
      color: #3182ce;
    }
    body.dark-mode .dark-toggle {
      color: #f56565;
    }
    .timers-section {
      display: flex;
      justify-content: center;
      gap: 60px;
      margin-top: 30px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    @media (max-width: 900px) {
      .timers-section {
        flex-direction: column;
        align-items: center;
        gap: 25px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Exam Timer</h1>
    <div class="option-group">
      <label>
        <input type="radio" name="mode" id="modeMin" checked onchange="toggleMode()"> Countdown (minutes)
      </label>
      <label>
        <input type="radio" name="mode" id="modeCal" onchange="toggleMode()"> Countdown to calendar date/time
      </label>
    </div>
    <div>
      <button class="preset-btn" onclick="setPreset(15)">15 min</button>
      <button class="preset-btn" onclick="setPreset(30)">30 min</button>
      <button class="preset-btn" onclick="setPreset(60)">60 min</button>
    </div>
    <div id="minGroup">
      <label>Set time (minutes): <input type="number" id="minutesInput" min="1" value="1"></label>
    </div>
    <div id="calGroup" style="display:none;">
      <label>Choose end date and time: <input type="datetime-local" id="calendarInput"></label>
    </div>
    <button onclick="startTimer()">Start</button>
    <div class="controls">
      <button id="pauseBtn" onclick="pauseTimer()" disabled>Pause</button>
      <button id="resumeBtn" onclick="resumeTimer()" disabled>Resume</button>
      <button onclick="resetTimer()">Reset</button>
      <span class="sound-toggle unmuted" id="soundToggle" onclick="toggleSound()" title="Toggle sound">&#128263;</span>
      <span class="dark-toggle" id="darkToggle" onclick="toggleDarkMode()" title="Toggle dark mode">&#9790;</span>
    </div>
    <div class="progress-bar"><div class="progress-inner" id="progressBar"></div></div>
    <div class="timers-section">
      <div>
        <span class="big-timer-label">Total Time Left</span>
        <div class="big-timer" id="totalTimer">60</div>
        <span class="breakdown" id="breakdown">(0d, 0h, 1m, 0s)</span>
      </div>
      <div>
        <span class="big-timer-label">Today's 24h Timer</span>
        <div class="big-timer" id="todayTimer">60</div>
        <span class="breakdown" id="daybreakdown">(0d, 0h, 1m, 0s)</span>
      </div>
    </div>
    <audio id="beep" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bpm-113845.mp3" preload="auto"></audio>
  </div>
  <script>
    let timerInterval;
    let totalTime = 60;
    let timeLeft = 60;
    let paused = false;
    let soundOn = true;

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('examTimerDarkMode', document.body.classList.contains('dark-mode') ? '1' : '0');
    }
    if (localStorage.getItem('examTimerDarkMode') === '1') {
      document.body.classList.add('dark-mode');
    }

    function toggleSound() {
      soundOn = !soundOn;
      document.getElementById('soundToggle').className = 'sound-toggle ' + (soundOn ? 'unmuted' : 'muted');
      localStorage.setItem('examTimerSound', soundOn ? '1' : '0');
    }
    if (localStorage.getItem('examTimerSound') === '0') {
      soundOn = false;
      document.getElementById('soundToggle').className = 'sound-toggle muted';
    }

    function setPreset(mins) {
      document.getElementById('minutesInput').value = mins;
      toggleMode(true);
    }
    function toggleMode(forceMin=false) {
      let modeMin = forceMin ? true : document.getElementById('modeMin').checked;
      document.getElementById('minGroup').style.display = modeMin ? '' : 'none';
      document.getElementById('calGroup').style.display = modeMin ? 'none' : '';
    }

    function startTimer() {
      clearInterval(timerInterval);
      paused = false;
      let modeMin = document.getElementById('modeMin').checked;
      if (modeMin) {
        let minutes = parseInt(document.getElementById('minutesInput').value);
        if (!minutes || minutes < 1) minutes = 1;
        timeLeft = minutes * 60;
        totalTime = timeLeft;
        saveLastUsed('min', minutes);
      } else {
        let calendarVal = document.getElementById('calendarInput').value;
        if (!calendarVal) {
          alert("Please select a date and time!");
          return;
        }
        let endTime = new Date(calendarVal).getTime();
        let now = Date.now();
        timeLeft = Math.floor((endTime - now) / 1000);
        totalTime = timeLeft;
        saveLastUsed('cal', calendarVal);
        if (timeLeft <= 0) {
          document.getElementById('totalTimer').textContent = "Selected time is in the past!";
          document.getElementById('breakdown').textContent = "";
          document.getElementById('todayTimer').textContent = "";
          document.getElementById('daybreakdown').textContent = "";
          updateControls(false, false);
          updateProgressBar(0);
          return;
        }
      }
      updateDisplay(timeLeft);
      updateControls(true, false);
      updateProgressBar(100);
      timerInterval = setInterval(() => {
        if (!paused) {
          timeLeft--;
          updateDisplay(timeLeft);
          updateProgressBar((timeLeft / totalTime) * 100);
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            updateDisplay(0);
            updateProgressBar(0);
            updateControls(false, false);
            if (soundOn) document.getElementById('beep').play();
            document.getElementById('totalTimer').innerHTML = "<span style='color:#e53e3e'>Time's up!</span>";
            document.getElementById('breakdown').textContent = "";
            document.getElementById('todayTimer').textContent = "";
            document.getElementById('daybreakdown').textContent = "";
          }
        }
      }, 1000);
    }

    function pauseTimer() {
      paused = true;
      updateControls(false, true);
    }
    function resumeTimer() {
      paused = false;
      updateControls(true, false);
    }
    function resetTimer() {
      clearInterval(timerInterval);
      paused = false;
      let last = getLastUsed();
      if (last.mode === 'min') {
        document.getElementById('modeMin').checked = true;
        toggleMode(true);
        document.getElementById('minutesInput').value = last.value || 1;
        timeLeft = (last.value ? last.value : 1) * 60;
        totalTime = timeLeft;
        updateDisplay(timeLeft);
      } else if (last.mode === 'cal') {
        document.getElementById('modeCal').checked = true;
        toggleMode();
        document.getElementById('calendarInput').value = last.value || "";
        let calendarVal = document.getElementById('calendarInput').value;
        if (calendarVal) {
          let endTime = new Date(calendarVal).getTime();
          let now = Date.now();
          timeLeft = Math.floor((endTime - now) / 1000);
          totalTime = timeLeft;
          updateDisplay(timeLeft);
        } else {
          document.getElementById('totalTimer').textContent = "Set a date/time!";
          document.getElementById('breakdown').textContent = "";
          document.getElementById('todayTimer').textContent = "";
          document.getElementById('daybreakdown').textContent = "";
        }
      }
      updateControls(true, false);
      updateProgressBar(100);
    }
    function updateControls(canPause, canResume) {
      document.getElementById('pauseBtn').disabled = !canPause;
      document.getElementById('resumeBtn').disabled = !canResume;
    }
    function updateProgressBar(percent) {
      let bar = document.getElementById('progressBar');
      bar.className = "progress-inner";
      bar.style.width = percent + "%";
      if (percent < 20) {
        bar.classList.add("urgent");
      } else if (percent < 50) {
        bar.classList.add("warning");
      }
    }
    function formatBreakdown(seconds) {
      if (seconds < 0) seconds = 0;
      const d = Math.floor(seconds / 86400);
      seconds %= 86400;
      const h = Math.floor(seconds / 3600);
      seconds %= 3600;
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `(${d}d, ${h}h, ${m}m, ${s}s)`;
    }
    function updateDisplay(seconds) {
      // Total timer
      document.getElementById('totalTimer').textContent = seconds;
      document.getElementById('breakdown').textContent = formatBreakdown(seconds);

      // Today's timer (time left in the current 24h chunk)
      let todaySecs = seconds > 86400 ? seconds % 86400 : seconds;
      if (todaySecs === 0 && seconds > 0) todaySecs = 86400; // if on day boundary, show full day
      document.getElementById('todayTimer').textContent = todaySecs;
      document.getElementById('daybreakdown').textContent = formatBreakdown(todaySecs);
    }
    function saveLastUsed(mode, value) {
      localStorage.setItem('examTimerLastMode', mode);
      localStorage.setItem('examTimerLastValue', value);
    }
    function getLastUsed() {
      return {
        mode: localStorage.getItem('examTimerLastMode') || 'min',
        value: localStorage.getItem('examTimerLastValue') || 1
      };
    }
    window.onload = function() {
      let last = getLastUsed();
      if (last.mode === 'min') {
        document.getElementById('modeMin').checked = true;
        toggleMode(true);
        document.getElementById('minutesInput').value = last.value;
      } else if (last.mode === 'cal') {
        document.getElementById('modeCal').checked = true;
        toggleMode();
        document.getElementById('calendarInput').value = last.value;
      }
      updateControls(true, false);
      updateProgressBar(100);
      updateDisplay(last.mode === 'min' ? (last.value * 60) : 60);
    };
  </script>
</body>
</html>